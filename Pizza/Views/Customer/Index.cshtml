@model IEnumerable<Pizza.DTO.CustomerDTO>
@{
    ViewBag.Title = "Index";
}

<h2>Index</h2>

<style>
    #content_wrapper {
        padding-top: 60px;
    }
</style>

<link href="~/Content/Swal/sweetalert.css" rel="stylesheet" />

<section id="content_wrapper">
    <section id="content" class="table-layout animated fadeIn">
        <div class="tray tray-center">
            <div class="row">
                <div class="col-md-12">
                    <div class="panel panel-visible" id="spy3">
                        <div class="panel-heading">
                            <div class="panel-title hidden-xs dheadings">
                                Customer List
                            </div>
                        </div>
                        <div class="row margintop10 marginright5"><a href="~/Customer/AddOrEditCustomer"><button type="submit" class="button btn-primary mr10 pull-right defaultbtn marginb10"><span class="glyphicon glyphicon-plus"></span>  Add a new Customer</button></a></div>
                        <div class="panel-body pn" id="person-list">
                            <table class="table table-striped table-hover" id="tblBildinginfo" cellspacing="0" width="100%">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>PhoneNumber</th>
                                        <th>Address1</th>
                                        <th>Address2</th>
                                        <th>City</th>
                                        <th>State</th>
                                        <th>EmployeeName</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                            </table>

                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- end: .tray-center -->

    </section>
    <!-- End: Content -->

</section>

<script src="@Url.Content("~/Content/Swal/sweetalert.min.js")"></script>

<script type="text/javascript">

    $(document).ready(function () {

        $('#tblBildinginfo').dataTable({
            "ajax": {
                "url": '@Url.Action("GetCustomers", "Customer")',
                "type": "POST",
                "dataType": "json"
            },
            "columns": [
                        { "data": "Name", "name": "Name" },
                        { "data": "PhoneNumber", "name": "PhoneNumber" },
                        { "data": "Address1", "name": "Address1" },
                        { "data": "Address2", "name": "Address2" },
                        { "data": "City", "name": "City" },
                        { "data": "State", "name": "State" },
                        { "data": "EmployeeName", "name": "EmployeeName" },
                        {
                            "title": "", "data": "", render: function (ImagePath, type, user) {
                                return `<div class="action-buttons"><a class="p5" title="Edit" id="Edit" href="AddOrEditCustomer/${user.CustormerUID}"><i class="fa fa-edit blue-color fa-2x"></i></a></div>`;
                            }
                        },
            ],
            "serverSide": "true",
            "iDisplayLength": 10,
            "sPaginationType": "full_numbers",
            "lengthChange": false,
            "aoColumnDefs": [
            { "bSortable": false, "aTargets": [4] },
            { "bSearchable": false, "aTargets": [0, 1, 2, 3] }
            ],
            "order": [0, "asc"],
            "processing": true,
            "language": {
                processing: "loading....",
                "infoFiltered": ""
            }
        });
    });

    function ShowErrorMessage(message) {
        swal({
            title: "",
            text: message,
            type: "error"
        });
    }
    function ShowSuccessMessage(message) {
        swal({
            title: "",
            text: message,
            type: "success"
        }, function () {
            location.reload();
        });
    }


    $('.DeleteUser').on("click", function () {
        var UserID = this.id;
        var UserID = JSON.stringify({
            "UserID": UserID
        });

        swal({
            title: "Are you sure?",
            text: "You want delete user!",
            type: "warning",
            showCancelButton: true,
            confirmButtonText: "Yes",
            cancelButtonText: "No",
            closeOnConfirm: true,
            closeOnCancel: true
        },
            function (isConfirm) {
                if (isConfirm) {
                    $(".loadingmodal").show();
                    $.ajax({
                        type: "POST",
                        url: DeleteUserURL,
                        data: UserID,
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        success: function (result) {
                            if (result.Status) {
                                ShowSuccessMessage(result.Message);
                                location.reload();
                            }
                            else {
                                ShowErrorMessage(result.Message);
                            }
                            $(".loadingmodal").hide();
                        },
                        error: function () {
                            $(".loadingmodal").hide();
                        }
                    });
                }
            })
    });
</script>